# Lean.CodeGen

## 1. 简介
Lean.CodeGen 是一个基于 .NET 8 的代码生成器，采用领域驱动设计(DDD)架构和 RBAC 权限模型，集成 Redis 缓存，旨在简化开发过程中的重复性工作。通过预定义的模板和数据模型，自动生成标准化的代码文件，提高开发效率和代码质量。

## 2. 技术栈

### 2.1 后端技术
- 基础框架：.NET 8
- 架构模式：领域驱动设计 (DDD)
- 权限模型：RBAC (基于角色的访问控制)
- ORM：SqlSugar 5.1.4.127
- 缓存：Redis 7.0+
- API文档：Swagger
- 对象映射：Mapster 7.4.0
- 依赖注入：Autofac 7.1.0
- 代码生成：Scriban 5.9.0

### 2.2 前端技术
- 框架：Ant Design Vue 4.x
- 构建工具：Vite
- 状态管理：Pinia
- HTTP 客户端：Axios
- TypeScript 5.x
- Vue Router 4.x

## 3. 功能特点

### 3.1 权限管理
- 用户管理：用户信息的增删改查
- 角色管理：角色的创建、分配和权限设置
- 权限管理：细粒度的功能权限控制
- 部门管理：组织架构管理
- 菜单管理：动态菜单配置
- 数据权限：基于角色的数据访问控制

### 3.2 代码生成
- 领域模型生成：自动生成领域实体和聚合根
- 仓储层生成：生成仓储接口和实现
- 应用服务生成：生成应用服务和 DTO
- 接口层生成：生成 RESTful API 控制器
- 前端代码生成：生成 Vue 组件和 API 调用
- 权限代码生成：生成权限相关代码和配置
- 缓存代码生成：生成 Redis 缓存相关代码

### 3.3 DDD分层架构
- 表现层：API 接口和前端界面
- 应用层：应用服务和用例编排
- 领域层：领域模型和业务规则
- 基础设施层：技术实现和外部服务

### 3.4 模板功能
- 支持自定义模板
- 模板语法简单直观
- 支持条件判断和循环
- 支持自定义函数扩展
- 支持批量生成

### 3.5 数据库支持
- SQL Server
- MySQL
- PostgreSQL
- Oracle
- SQLite

### 3.6 缓存功能
- 分布式缓存：使用 Redis 实现
- 缓存策略：滑动过期和绝对过期
- 缓存穿透防护：布隆过滤器
- 缓存击穿防护：互斥锁
- 缓存雪崩防护：随机过期时间
- 多级缓存：内存缓存+分布式缓存

## 4. 项目结构
```
Lean.CodeGen/
├── backend/
│   └── src/
│       ├── Common/             # 公共层
│       │   ├── Enums/        # 枚举定义
│       │   ├── Extensions/   # 扩展方法
│       │   ├── Helpers/      # 帮助类
│       │   ├── Constants/    # 常量定义
│       │   └── Utils/        # 工具类
│       ├── Domain/            # 领域层
│       │   ├── Interfaces/   # 接口定义
│       │   └── Entities/     # 实体目录
│       │       ├── System/   # 系统管理
│       │       └── Security/ # 权限管理
│       ├── Application/       # 应用层
│       │   ├── Services/     # 应用服务
│       │   │   ├── System/  # 系统服务
│       │   │   └── Security/# 权限服务
│       │   ├── Caching/     # 缓存服务
│       │   │   ├── Redis/   # Redis实现
│       │   │   └── Memory/  # 内存缓存
│       │   └── Dtos/         # 数据传输对象
│       ├── Infrastructure/    # 基础设施层
│       │   ├── Data/         # 数据访问层
│       │   │   ├── Context/ # 数据库上下文
│       │   │   └── Config/  # 实体配置
│       │   ├── Repositories/ # 仓储实现
│       │   └── Services/     # 外部服务
│       ├── WebApi/           # 表现层
│       │   └── Controllers/  # API控制器
│       └── Templates/        # 代码模板
├── frontend/
│   └── src/
│       ├── components/   # Vue组件
│       ├── views/        # 页面
│       │   ├── system/  # 系统管理
│       │   └── security/# 权限管理
│       ├── api/         # API调用
│       └── store/       # 状态管理
├── docs/                # 文档
└── tests/              # 测试项目
```

## 5. 权限模型

### 5.1 RBAC模型设计
- 用户（User）：系统的使用者
- 角色（Role）：权限的集合
- 权限（Permission）：功能权限点
- 部门（Department）：组织架构
- 菜单（Menu）：系统功能菜单
- 数据范围（DataScope）：数据访问范围

### 5.2 权限控制
- 接口权限：基于角色的API访问控制
- 菜单权限：动态菜单显示控制
- 按钮权限：页面按钮的显示控制
- 数据权限：数据访问范围控制
- 字段权限：敏感字段的显示控制

## 6. 开发环境
- Visual Studio 2022
- .NET 8.0 SDK
- SQL Server 2019+ / MySQL 8.0+
- Redis 7.0+

## 7. 使用场景

### 7.1 数据访问层
- 生成实体类和数据库映射
- 生成仓储接口和实现
- 生成数据库上下文

### 7.2 业务逻辑层
- 生成服务接口
- 生成服务实现类
- 生成业务模型

### 7.3 表现层
- 生成 API 控制器
- 生成视图模型
- 生成数据传输对象

## 8. 最佳实践

### 8.1 模板管理
- 按功能模块组织模板
- 保持模板简单清晰
- 统一命名规范
- 定期维护更新

### 8.2 生成策略
- 增量生成
- 文件覆盖保护
- 代码区域保护
- 自定义代码保留

### 8.3 性能优化
- 模板缓存
- 批量生成
- 异步操作
- 资源复用
- Redis 缓存优化
  - 合理的过期策略
  - 缓存预热
  - 缓存更新机制
  - 缓存监控告警

## 9. 注意事项
1. 定期备份自定义模板
2. 注意生成文件的编码格式
3. 遵循代码生成规范
4. 合理使用自定义标记
5. 保护自定义代码区域
6. 定期更新模板缓存

## 10. 常见问题

### 10.1 模板问题
- 模板语法错误解决方案
- 自定义函数使用说明
- 模板缓存更新机制

### 10.2 生成问题
- 文件覆盖处理
- 编码格式问题
- 命名空间冲突

### 10.3 数据库问题
- 数据类型映射
- 主键处理
- 关系映射

### 10.4 缓存问题
- 缓存穿透解决方案
- 缓存击穿处理
- 缓存雪崩预防
- 缓存一致性维护
- 缓存监控方案

## 11. 更新计划
1. 支持更多数据库类型
2. 优化模板管理机制
3. 增加更多代码生成场景
4. 提供 Web 可视化界面
5. 支持跨平台部署
6. 完善缓存管理功能
7. 优化缓存性能监控

## 12. 许可证
MIT License 